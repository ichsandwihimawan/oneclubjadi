{% load static %} {% load humanize %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Profile - ONECLUB</title>

    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link rel="stylesheet" href="{% static 'assets/css/style.css' %}" />
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="{% static 'assets/css/bootstrap.css' %}" />

    <link
      rel="stylesheet"
      href="{% static 'assets/vendors/iconly/bold.css' %}"
    />
    <link
      rel="stylesheet"
      href="{% static 'assets/vendors/perfect-scrollbar/perfect-scrollbar.css' %}"
    />
    <link
      rel="stylesheet"
      href="{% static 'assets/vendors/bootstrap-icons/bootstrap-icons.css' %}"
    />
    <link rel="stylesheet" href="{% static 'assets/css/app.css' %}" />
  </head>

  <body>
    <div id="app">
      {% include "snippets/sidebar.html" %}
      <div id="main" class="layout-navbar">
        {% include "snippets/topbar.html" %}

        <!-- CONTENT -->
        <div id="main-content">
          <div class="container">
            <div class="main-body">
              <div class="row">
                <div class="col-lg-4">
                  <div class="card">
                    <div class="card-body">
                      <div
                        class="d-flex flex-column align-items-center text-center"
                      >
                        <img
                          src="https://via.placeholder.com/110x110"
                          alt="Admin"
                          class="rounded-circle p-1 bg-primary"
                          width="110"
                        />
                        <div class="mt-3">
                          <h4>{{user.data_user.name}}</h4>
                          <p class="mb-1">ONECLUB Member</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-lg-8">
                  <div class="card">
                    <div class="card-body">
                      <div class="row mb-3">
                        <div class="col-sm-3">
                          <h6 class="mb-0">Nama</h6>
                        </div>
                        <div class="col-sm-9">
                          <input
                            type="text"
                            class="form-control"
                            value="{{user.data_user.name}}"
                            readonly
                          />
                        </div>
                      </div>
                      <div class="row mb-3">
                        <div class="col-sm-3">
                          <h6 class="mb-0">Email</h6>
                        </div>
                        <div class="col-sm-9">
                          <input
                            type="text"
                            class="form-control"
                            value="{{user.data_user.email}}"
                            readonly
                          />
                        </div>
                      </div>
                      <div class="row mb-3">
                        <div class="col-sm-3">
                          <h6 class="mb-0">Nomor Telepon</h6>
                        </div>
                        <div class="col-sm-9">
                          <input
                            type="text"
                            class="form-control"
                            value="{{user.data_user.phone}}"
                            readonly
                          />
                        </div>
                      </div>
                      <div class="row mb-3">
                        <div class="col-sm-3">
                          <h6 class="mb-0">Nama Bank</h6>
                        </div>
                        <div class="col-sm-9">
                          <input
                            type="text"
                            class="form-control"
                            value="{{user.data_user.nama_bank}}"
                            readonly
                          />
                        </div>
                      </div>
                      <div class="row mb-3">
                        <div class="col-sm-3">
                          <h6 class="mb-0">Nomor Rekening</h6>
                        </div>
                        <div class="col-sm-9">
                          <input
                            type="text"
                            class="form-control"
                            value="{{user.data_user.no_rekening}}"
                            readonly
                          />
                        </div>
                      </div>
                      <div class="row mb-3">
                        <div class="col-sm-3">
                          <h6 class="mb-0">Link Referal</h6>
                        </div>
                        <div class="col-sm-9">
                          <input
                            id="link_ref"
                            type="text"
                            class="form-control"
                            value="{{request.scheme}}://{{request.META.HTTP_HOST}}{% url 'register-with-ref' ref_code=user.data_user.referal_code %}"
                            readonly
                          />
                          <button
                            class="btn btn-success"
                            style="
                              position: absolute;
                              right: -25px;
                              top: 289px;
                              margin-top: 2px !important;
                              z-index: 2px;
                              font-size: 10px;
                              text-align: center;
                              font-family: 'Segoe UI', Tahoma, Geneva, Verdana,
                                sans-serif;
                            "
                          >
                            Copy
                          </button>
                        </div>
                      </div>
                      <div class="row mb-3">
                        <button
                          class="btn btn-success"
                          data-bs-toggle="modal"
                          data-bs-target="#exampleModal4"
                        >
                          Change Password
                        </button>
                      </div>
                      <div
                        class="modal fade"
                        id="exampleModal4"
                        tabindex="-1"
                        aria-labelledby="exampleModalLabel"
                        aria-hidden="true"
                      >
                        <div
                          class="modal-dialog modal-dialog-centered modal-lg"
                        >
                          <div class="modal-content">
                            <div class="modal-body">
                              <form id="change-password">
                                <div class="row mb-3">
                                  <div class="col-sm-3">
                                    <h6 class="mb-0">Old Password</h6>
                                  </div>
                                  <div class="col-sm-9">
                                    <input
                                      name="old_password"
                                      type="password"
                                      class="form-control"
                                      placeholder="Password"
                                      onKeyDown="if(event.keyCode === 32) return false;"
                                    />
                                  </div>
                                </div>
                                <div class="row mb-3">
                                  <div class="col-sm-3">
                                    <h6 class="mb-0">New Password</h6>
                                  </div>
                                  <div class="col-sm-9">
                                    <input
                                      name="new_password1"
                                      type="password"
                                      class="form-control"
                                      placeholder="Password"
                                      onKeyDown="if(event.keyCode === 32) return false;"
                                    />
                                  </div>
                                </div>

                                <div class="row mb-3">
                                  <div class="col-sm-3">
                                    <h6 class="mb-0">Confirm New Password</h6>
                                  </div>
                                  <div class="col-sm-9">
                                    <input
                                      name="new_password2"
                                      type="password"
                                      class="form-control"
                                      placeholder="Confirm Password"
                                      onKeyDown="if(event.keyCode === 32) return false;"
                                    />
                                  </div>
                                </div>
                              </form>
                              <div class="modal-footer">
                                <button
                                  type="button"
                                  class="btn btn-light-primary"
                                  data-bs-dismiss="modal"
                                >
                                  Close
                                </button>
                                <button
                                  type="button"
                                  class="btn btn-primary ml-1"
                                  id="btn-change"
                                >
                                  Submit
                                </button>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="{% static 'assets/vendors/perfect-scrollbar/perfect-scrollbar.min.js' %}"></script>
    <script src="{% static 'assets/js/bootstrap.bundle.min.js' %}"></script>
    <script
      type="text/javascript"
      src="https://code.jquery.com/jquery-1.11.3.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/js/bootstrap-datepicker.min.js"
    ></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/css/bootstrap-datepicker3.css"
    />
    <script src="{% static 'assets/js/extensions/sweetalert.min.js' %}"></script>
    <script src="{% static 'assets/js/main.js' %}"></script>
    <!-- Include Date Range Picker -->
    <script>
      $("#link_ref").click(function () {
        var copyText = document.getElementById("link_ref");
        copyText.select();
        copyText.setSelectionRange(0, 99999);
        document.execCommand("copy");
        return alert("Copied to the clipboard");
      });

      var base_url = window.location.origin;
      function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== "") {
          const cookies = document.cookie.split(";");
          for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === name + "=") {
              cookieValue = decodeURIComponent(
                cookie.substring(name.length + 1)
              );
              break;
            }
          }
        }
        return cookieValue;
      }
      const csrftoken = getCookie("csrftoken");

      $("#btn-change").click(function () {
        var data = $("#change-password").serialize();
        $.ajax({
          type: "POST",
          url: base_url + "/transaction/change-password/",
          headers: { "X-CSRFToken": csrftoken },
          data: data,
          dataType: "json",
          success: function (data) {
            setTimeout(location.reload.bind(location), 2000);
            swal(data, "", "success");
          },
          error: function (errMsg) {
            swal("Error", errMsg.responseText, "error");
          },
        });
      });
    </script>
  </body>
</html>
